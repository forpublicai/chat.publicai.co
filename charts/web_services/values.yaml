# Global values for web-services umbrella chart
global:
  # Shared namespace for all services
  namespace: web-services
  
  # AWS configuration
  aws:
    region: eu-central-2
    
  # Ingress now handled by infrastructure chart

# OpenWebUI configuration - only environment-specific overrides
open-webui:
  enabled: true
  
  # Production-specific overrides
  app:
    webuiUrl: "https://chat.publicai.co"
    replicas: 2  
    
    # Production storage configuration
    storage:
      s3:
        bucketName: publicai-bucket
        region: eu-central-2
        keyPrefix: uploads/
        endpointUrl: 	https://s3.eu-central-2.amazonaws.com
    
    # Production resource allocation for 5k concurrent users
    resources:
      requests:
        memory: "2Gi"
        cpu: "300m"
      limits:
        memory: "4Gi"
        cpu: "1000m"

  # Autoscaling for high load
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 85

  serviceAccount:
    roleArn: arn:aws:iam::901779868336:role/OpenWebUI-IRSA-Role

  # Secrets configuration
  secrets:
    name: web-services-secrets
    licenseKey: ""
    webuiSecretKey: ""
    databaseUrl: ""
    redisUrl: ""
    # googleClientId: ""
    # googleClientSecret: ""
    oauthClientId: ""
    oauthClientSecret: ""
    openidProviderUrl: ""
    openidRedirectUri: ""

# SearXNG configuration
searxng:
  enabled: false
  service:
    name: searxng-service
    port: 8080
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi" 
      cpu: "1000m"

# Tika configuration
tika:
  enabled: true
  service:
    name: tika-service
    port: 9998
  javaOpts: "-Xms256m -Xmx1g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
  resources:
    requests:
      memory: "768Mi"    # Match actual memory request
      cpu: "250m"        # Match actual CPU request
    limits:
      memory: "2Gi"      # Keep high for OCR/large PDFs!
      cpu: "1000m"

# LiteLLM configuration
litellm:
  enabled: true
  secrets:
    litellmMasterKey: ""
  lago:
    enabled: true  # Set to true to enable Lago billing integration

# Lago billing platform configuration (official chart)
lago:
  enabled: true

  # Required URLs
  apiUrl: "https://lago-api.publicai.co"
  frontUrl: "https://lago.publicai.co"

  # Use existing external database and Redis
  global:
    databaseUrl: ""  # Set via --set from web.sh
    redisUrl: ""  # Set via --set from web.sh

    # Disable signup
    signup:
      enabled: true

    # Enable S3 storage
    s3:
      enabled: true
      bucket: "publicai-bucket"
      region: "eu-central-2"
      endpoint: "https://s3.eu-central-2.amazonaws.com"

    # SMTP configuration
    smtp:
      enabled: false
      fromEmail: "support@publicai.co"

    # Disable PDF generation for now
    pdf:
      enabled: true

    # Disable ingress (we're using our own)
    ingress:
      enabled: false

  # Disable internal PostgreSQL and Redis (using external)
  postgresql:
    enabled: false

  redis:
    enabled: false

  # Resource configuration
  front:
    replicaCount: 1
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"

  api:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  worker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  # All worker types (billing, clock, events, payment, pdf, webhook)
  billingWorker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  clockWorker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  eventsWorker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  paymentWorker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  pdfWorker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

  webhookWorker:
    replicaCount: 1
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"